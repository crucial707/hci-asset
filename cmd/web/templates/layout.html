{{define "layout"}}
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>{{block "title" .}}Dashboard{{end}} – Humboldt Cyber Intelligence</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/water.css@2/out/water.min.css">
  <style>
    :root {
      --hci-dark: #1a3a4a;
      --hci-accent: #2d5a6b;
      --hci-teal: #7eb8c9;
      --focus-ring: 2px solid var(--hci-teal);
      --focus-offset: 2px;
    }
    body { max-width: 960px; margin: 0 auto; padding: 1rem; }
    .skip-link {
      position: absolute;
      top: -2.5rem;
      left: 0.5rem;
      padding: 0.5rem 0.75rem;
      background: var(--hci-dark);
      color: #fff;
      text-decoration: none;
      border-radius: 4px;
      z-index: 100;
      transition: top 0.15s ease;
    }
    .skip-link:focus { top: 0.5rem; outline: var(--focus-ring); outline-offset: var(--focus-offset); }
    .brand-header {
      display: flex;
      align-items: center;
      gap: 1rem;
      margin-bottom: 1rem;
      padding-bottom: 1rem;
      border-bottom: 2px solid var(--hci-teal);
    }
    .brand-header a { text-decoration: none; color: inherit; display: flex; align-items: center; gap: 0.75rem; }
    .brand-header a:focus-visible { outline: var(--focus-ring); outline-offset: var(--focus-offset); border-radius: 4px; }
    .brand-header img { height: 48px; width: auto; display: block; }
    .brand-text { line-height: 1.2; }
    .brand-name { font-size: 1.25rem; font-weight: 700; color: var(--hci-dark); }
    .brand-product { font-size: 0.85rem; color: var(--hci-accent); }
    nav {
      display: flex;
      flex-wrap: wrap;
      align-items: center;
      gap: 0.5rem 1rem;
      margin-bottom: 1.5rem;
    }
    nav a { margin-right: 0; }
    nav a:focus-visible, nav a:hover { outline: var(--focus-ring); outline-offset: var(--focus-offset); border-radius: 2px; }
    .nav-spacer { margin-left: auto; }
    .error { color: #c00; }
    .global-error {
      background: #fdd;
      border: 1px solid #c00;
      border-radius: 4px;
      padding: 0.75rem 1rem;
      margin-bottom: 1rem;
      color: #800;
    }
    .field-error { font-size: 0.9rem; color: #c00; display: block; margin-top: 0.25rem; }
    main { min-height: 40vh; }
    main:focus { outline: none; }
    main section { margin-top: 1.5rem; }
    main section:first-child { margin-top: 0; }
    main h1 { margin-top: 0; margin-bottom: 1rem; font-size: 1.5rem; }
    main h2 { margin-top: 1.25rem; margin-bottom: 0.5rem; font-size: 1.15rem; }
    .table-wrap { overflow-x: auto; margin: 1rem 0; -webkit-overflow-scrolling: touch; }
    .table-wrap table { width: 100%; min-width: 480px; }
    th, td { text-align: left; padding: 0.5rem 0.75rem; }
    button:focus-visible, input:focus-visible, textarea:focus-visible, select:focus-visible {
      outline: var(--focus-ring); outline-offset: var(--focus-offset);
    }
    a:focus-visible { outline: var(--focus-ring); outline-offset: var(--focus-offset); border-radius: 2px; }
    .page-footer {
      margin-top: 2.5rem;
      padding-top: 1rem;
      border-top: 1px solid #eee;
      font-size: 0.85rem;
      color: #666;
    }
    @media (max-width: 640px) {
      body { padding: 0.75rem; }
      .brand-header { gap: 0.75rem; }
      .brand-name { font-size: 1.1rem; }
      nav { gap: 0.5rem; margin-bottom: 1rem; }
      .nav-spacer { margin-left: 0; width: 100%; order: -1; }
      .nav-user { font-size: 0.9rem; }
      main h1 { font-size: 1.25rem; }
      .table-wrap { margin-left: -0.75rem; margin-right: -0.75rem; padding: 0 0.75rem; }
      th, td { padding: 0.4rem 0.5rem; font-size: 0.9rem; }
    }
  </style>
  {{if .BodyClass}}<style>body.network-viz{max-width:none;}body.network-viz main{max-width:none;padding:0.5rem;}body.network-viz .network-viz-container{min-height:70vh;width:100%;}</style>{{end}}
</head>
<body {{if .BodyClass}}class="{{.BodyClass}}"{{end}}>
  <a href="#main" class="skip-link">Skip to main content</a>
  <header class="brand-header" role="banner">
    <a href="/dashboard" aria-label="Humboldt Cyber Intelligence – go to dashboard">
      <img src="/static/logo.svg" alt="" width="48" height="48">
      <span class="brand-text">
        <span class="brand-name">Humboldt Cyber Intelligence</span>
        <span class="brand-product">Asset &amp; Security</span>
      </span>
    </a>
  </header>
  <nav aria-label="Main navigation">
    <span class="nav-spacer"></span>
    <a href="/dashboard">Dashboard</a>
    <a href="/assets">Assets</a>
    <a href="/users">Users</a>
    <a href="/scans">Active Scans</a>
    <a href="/saved-scans">Saved Scans</a>
    <a href="/schedules">Schedules</a>
    <a href="/audit">Audit log</a>
    <a href="/network">Network</a>
    {{if .User}}<span class="nav-user" aria-label="Logged in as {{.User.Username}}, {{.User.Role}}">Logged in as <strong>{{.User.Username}}</strong> ({{.User.Role}})</span>{{end}}
    <a href="/logout">Log out</a>
  </nav>
  <main id="main" tabindex="-1" role="main">
  {{if .Error}}<div class="global-error" role="alert">{{.Error}}</div>{{end}}
  {{template "content" .}}
  </main>
  <script>
  (function() {
    if (window.location.hash === '#main') {
      var main = document.getElementById('main');
      if (main) main.focus();
    }
    document.querySelectorAll('form').forEach(function(f) {
      f.addEventListener('submit', function() {
        var btn = f.querySelector('button[type="submit"]');
        if (btn && !btn.disabled) {
          btn.disabled = true;
          btn.dataset.originalText = btn.textContent;
          btn.textContent = btn.dataset.loadingText || 'Saving...';
        }
      });
    });
  })();
  </script>
  <footer class="page-footer" role="contentinfo">
    Humboldt Cyber Intelligence · Asset inventory &amp; security
  </footer>
</body>
</html>
{{end}}
