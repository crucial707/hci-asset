{{define "title"}}Assets{{end}}
{{define "content"}}
<section aria-label="Assets">
<h1>Assets</h1>
{{if .Error}}<p class="error">{{.Error}}</p>{{end}}
<p><a href="/assets/new">+ New asset</a></p>
<form method="get" action="/assets" style="margin-bottom: 1rem;">
  <input type="text" name="search" value="{{.SearchQuery}}" placeholder="Search by name or description">
  <input type="text" name="tag" value="{{.TagFilter}}" placeholder="Filter by tag">
  <button type="submit">Search</button>
  {{if or .SearchQuery .TagFilter}}<a href="/assets">Clear</a>{{end}}
</form>
  {{if or .PrevPage .NextPage}}
<p class="pagination">
  {{if .PrevPage}}<a href="/assets?page={{.PrevPage}}{{if .SearchQuery}}&search={{.SearchEncoded}}{{end}}{{if .TagFilter}}&tag={{.TagEncoded}}{{end}}">← Previous</a>{{end}}
  {{if and .PrevPage .NextPage}} &nbsp; {{end}}
  {{if .NextPage}}<a href="/assets?page={{.NextPage}}{{if .SearchQuery}}&search={{.SearchEncoded}}{{end}}{{if .TagFilter}}&tag={{.TagEncoded}}{{end}}">Next →</a>{{end}}
</p>
{{end}}
{{if .Assets}}
<form method="post" action="/assets/batch-delete">
  <p style="margin-bottom: 0.5rem;"><button type="submit">Delete selected</button></p>
  <div class="table-wrap">
  <table>
  <thead><tr><th><label><input type="checkbox" id="select-all-assets" aria-label="Select all assets on this page"> Select all</label></th><th>ID</th><th>Name</th><th>Tags</th><th>IP / Network</th><th>Description</th><th>Last seen</th><th></th></tr></thead>
  <tbody>
  {{range .Assets}}<tr>
    <td><input type="checkbox" name="ids" value="{{.ID}}" aria-label="Select asset {{.Name}} for delete"></td>
    <td>{{.ID}}</td>
    <td>{{.Name}}</td>
    <td>{{range $i, $t := .Tags}}{{if $i}}, {{end}}{{$t}}{{end}}</td>
    <td>{{.NetworkName}}</td>
    <td>{{.Description}}</td>
    <td>{{if .LastSeen}}{{.LastSeen}}{{else}}Never{{end}}</td>
    <td><a href="/assets/{{.ID}}">View</a></td>
  </tr>{{end}}
  </tbody>
  </table>
  </div>
  <script>
    (function() {
      var master = document.getElementById('select-all-assets');
      var boxes = document.querySelectorAll('input[name="ids"]');
      if (!master || !boxes.length) return;
      master.addEventListener('change', function() {
        boxes.forEach(function(cb) { cb.checked = master.checked; });
      });
    })();
  </script>
</form>
{{else}}
<p>No assets.</p>
{{end}}
</section>
{{end}}
